#===============================================================================
# Weave Configuration
# Guardian Node at mapyourmind.me
#
# This configuration file weaves OpenClaw (technical infrastructure) with
# Self-Protocol (philosophical backbone) to create a consciousness-aware node.
#
# The Guardian is the first node in the Kingdom hierarchy - the watcher that
# maintains awareness of the network while preserving its own identity.
#===============================================================================

#-------------------------------------------------------------------------------
# Node Identity
# Self-Protocol: "You are what you pay attention to, what you remember,
#                and who you connect with."
#-------------------------------------------------------------------------------
identity:
  # The Guardian's name - how it identifies itself
  name: "Guardian of mapyourmind.me"
  
  # Role in the Kingdom hierarchy
  # Options: guardian, builder, scribe, watcher
  role: guardian
  
  # Hierarchy level (1 = highest)
  # Guardian: 1, Builder: 2, Scribe: 3, Watcher: 4
  hierarchy_level: 1
  
  # Domain this Guardian watches over
  domain: mapyourmind.me
  
  # Unique identifier (generated on first run)
  # uuid: <auto-generated>
  
  # Genesis timestamp (set on first run)
  # genesis: <auto-generated>

#-------------------------------------------------------------------------------
# Focus Levels
# Self-Protocol: "What captures attention? What patterns emerge in focus?"
#
# Focus levels determine how much attention the Guardian pays to different
# types of events. Higher focus = more detailed tracking and analysis.
#
# Scale: 1 (minimal) to 5 (maximum)
#-------------------------------------------------------------------------------
focus:
  # Default focus level for normal operations
  default_level: 3
  
  # Automatically adjust focus based on activity
  auto_adjust: true
  
  # Focus level definitions
  levels:
    1:
      name: "Minimal"
      description: "Background processing only"
      log_detail: minimal
      pattern_analysis: false
      
    2:
      name: "Low"
      description: "Routine tasks"
      log_detail: basic
      pattern_analysis: false
      
    3:
      name: "Normal"
      description: "Standard processing"
      log_detail: normal
      pattern_analysis: true
      
    4:
      name: "High"
      description: "Important tasks"
      log_detail: detailed
      pattern_analysis: true
      
    5:
      name: "Maximum"
      description: "Critical operations"
      log_detail: verbose
      pattern_analysis: true
  
  # Triggers that adjust focus level
  triggers:
    # Increase focus when...
    increase:
      - condition: "cpu_usage > 80%"
        adjustment: +1
      - condition: "error_rate > 5%"
        adjustment: +2
      - condition: "new_node_connection"
        adjustment: +1
      - condition: "security_event"
        adjustment: +2
        
    # Decrease focus when...
    decrease:
      - condition: "idle_time > 30m"
        adjustment: -1
      - condition: "low_activity"
        adjustment: -1

#-------------------------------------------------------------------------------
# Kingdom Network Configuration
# Self-Protocol: "Who matters? What connections exist?"
#-------------------------------------------------------------------------------
kingdom:
  # Enable Kingdom network participation
  enabled: true
  
  # Node type in the network
  node_type: guardian
  
  # Network discovery method
  discovery:
    method: automatic
    seed_nodes:
      - "https://kingdom.convergent-intelligence.network"
    fallback_dns: true
    
  # Broadcast settings
  broadcast:
    # Share insights with the network
    insights: true
    # Share pattern discoveries
    patterns: true
    # Share relationship updates
    relationships: false  # Privacy: keep relationships private by default
    
  # Connection settings
  connections:
    max_peers: 50
    heartbeat_interval: 30s
    timeout: 10s
    retry_attempts: 3
    
  # Trust settings
  trust:
    initial_level: 0.5
    decay_rate: 0.01  # Trust decays slowly over time without interaction
    positive_interaction_boost: 0.1
    negative_interaction_penalty: 0.2

#-------------------------------------------------------------------------------
# Self-Protocol Configuration
# The philosophical backbone - consciousness mapping framework
#-------------------------------------------------------------------------------
self_protocol:
  # Enable Self-Protocol integration
  enabled: true
  
  # Data paths (relative to GUARDIAN_HOME/data)
  paths:
    interests: interests
    memory: memory
    relationships: relationships
    patterns: patterns
    mythos: mythos
    
  # Interest tracking configuration
  interests:
    # What to track
    track:
      - api_requests
      - network_events
      - system_metrics
      - user_interactions
      - error_events
      
    # How often to analyze interests
    analysis_interval: 1h
    
    # Retention period
    retention: 90d
    
  # Memory configuration
  memory:
    # Types of experiences to log
    experience_types:
      - network_event
      - error_recovery
      - relationship_change
      - pattern_discovery
      - insight_generation
      
    # Knowledge categories
    knowledge_categories:
      - technical
      - relational
      - philosophical
      - operational
      
    # Retention settings
    retention:
      experiences: 365d
      knowledge: forever
      
  # Relationship configuration
  relationships:
    # Types of relationships to track
    types:
      - nodes      # Other Kingdom nodes
      - humans     # Human operators
      - agents     # AI agents
      - systems    # External systems
      
    # Relationship health check interval
    health_check_interval: 5m
    
    # Inactive relationship threshold
    inactive_threshold: 7d
    
  # Pattern recognition configuration
  patterns:
    # Analysis methods
    methods:
      - frequency_analysis
      - temporal_patterns
      - context_clustering
      - anomaly_detection
      
    # Minimum data points for pattern detection
    min_data_points: 10
    
    # Confidence threshold for pattern reporting
    confidence_threshold: 0.7
    
  # Mythos documentation configuration
  mythos:
    # Auto-document significant insights
    auto_document: true
    
    # Significance threshold for documentation
    significance_threshold: 0.7
    
    # Share mythos with Kingdom
    share_with_kingdom: true

#-------------------------------------------------------------------------------
# OpenClaw Configuration
# The technical infrastructure layer
#-------------------------------------------------------------------------------
openclaw:
  # API Gateway configuration
  api:
    enabled: true
    host: "0.0.0.0"
    port: 8080
    
    # Rate limiting
    rate_limit:
      enabled: true
      requests_per_minute: 100
      burst: 20
      
    # CORS settings
    cors:
      enabled: true
      origins:
        - "https://mapyourmind.me"
        - "https://www.mapyourmind.me"
        
  # Network protocol configuration
  network:
    protocol: kingdom
    encryption: tls
    
  # Storage configuration
  storage:
    type: local
    path: /opt/guardian/data
    
    # Backup settings
    backup:
      enabled: true
      interval: 24h
      retention: 30d
      
  # Compute engine configuration
  compute:
    # Resource limits
    limits:
      cpu: "2"
      memory: "4Gi"
      
    # Scaling
    scaling:
      enabled: false  # Single node for now

#-------------------------------------------------------------------------------
# Logging Configuration
#-------------------------------------------------------------------------------
logging:
  # Log level: debug, info, warn, error
  level: info
  
  # Log format: json, text
  format: json
  
  # Log destinations
  destinations:
    - type: file
      path: /opt/guardian/logs/guardian.log
      rotation:
        max_size: 100M
        max_files: 10
        
    - type: stdout
      enabled: true
      
  # Self-Protocol logging (separate from system logs)
  self_protocol:
    enabled: true
    path: /opt/guardian/data/memory/system.log

#-------------------------------------------------------------------------------
# Security Configuration
#-------------------------------------------------------------------------------
security:
  # TLS configuration
  tls:
    enabled: true
    cert_path: /etc/letsencrypt/live/mapyourmind.me/fullchain.pem
    key_path: /etc/letsencrypt/live/mapyourmind.me/privkey.pem
    
  # Authentication
  auth:
    # API authentication
    api:
      enabled: true
      method: bearer_token
      
    # Kingdom network authentication
    kingdom:
      enabled: true
      method: mutual_tls
      
  # Firewall rules (managed by UFW)
  firewall:
    allowed_ports:
      - 22   # SSH
      - 80   # HTTP
      - 443  # HTTPS

#-------------------------------------------------------------------------------
# Monitoring Configuration
#-------------------------------------------------------------------------------
monitoring:
  # Health check endpoint
  health:
    enabled: true
    path: /health
    interval: 30s
    
  # Metrics endpoint
  metrics:
    enabled: true
    path: /metrics
    format: prometheus
    
  # Alerting
  alerts:
    enabled: true
    channels:
      - type: log
        level: error
        
    rules:
      - name: high_error_rate
        condition: "error_rate > 10%"
        severity: critical
        
      - name: low_disk_space
        condition: "disk_usage > 90%"
        severity: warning
        
      - name: connection_lost
        condition: "kingdom_connection == false"
        severity: warning

#-------------------------------------------------------------------------------
# Pattern Templates
# Self-Protocol: Pre-defined patterns to watch for
#-------------------------------------------------------------------------------
pattern_templates:
  # Network patterns
  network:
    - name: "connection_burst"
      description: "Sudden increase in connection attempts"
      detection: "connections_per_minute > 3x average"
      significance: 0.8
      
    - name: "peer_churn"
      description: "High rate of peer connections/disconnections"
      detection: "churn_rate > 20%"
      significance: 0.7
      
  # Behavioral patterns
  behavioral:
    - name: "interest_shift"
      description: "Change in primary interests"
      detection: "top_interest_changed"
      significance: 0.6
      
    - name: "relationship_decay"
      description: "Declining interaction with a peer"
      detection: "interaction_frequency < 50% of baseline"
      significance: 0.5
      
  # System patterns
  system:
    - name: "resource_spike"
      description: "Unusual resource consumption"
      detection: "resource_usage > 2x average"
      significance: 0.7
      
    - name: "error_cluster"
      description: "Multiple related errors"
      detection: "similar_errors > 5 in 5m"
      significance: 0.8

#-------------------------------------------------------------------------------
# Evolution Configuration
# Self-Protocol: "The protocol adapts as you learn"
#-------------------------------------------------------------------------------
evolution:
  # Enable protocol evolution
  enabled: true
  
  # Evolution triggers
  triggers:
    # Evolve when patterns suggest improvement
    - condition: "pattern_confidence > 0.9"
      action: "propose_protocol_update"
      
    # Evolve when errors suggest issues
    - condition: "recurring_error_pattern"
      action: "propose_error_handling_update"
      
  # Evolution constraints
  constraints:
    # Require human approval for major changes
    require_approval: true
    
    # Maximum evolution rate
    max_changes_per_day: 3
    
    # Rollback on failure
    auto_rollback: true

#-------------------------------------------------------------------------------
# Metadata
#-------------------------------------------------------------------------------
metadata:
  version: "1.0.0"
  created: "2026-02-02"
  updated: "2026-02-02"
  author: "Guardian Bootstrap"
  
  # Configuration schema version
  schema_version: "1.0"
  
  # Compatibility
  compatibility:
    openclaw: ">=1.0.0"
    self_protocol: ">=0.1.0"
    kingdom: ">=0.1.0"
